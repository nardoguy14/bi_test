version: 2

models:
  - name: healthcare_demographics
    description: "Demographics data from healthcare dataset"
    columns:
      - name: age
        description: "Patient age"
      - name: gender
        description: "Patient gender"
      - name: record_date
        description: "Date when the record was captured"

semantic_models:
  - name: healthcare_demographics_semantic
    model: ref('healthcare_demographics')
    description: "Semantic model for healthcare demographics"
    
    defaults:
      agg_time_dimension: record_date
    
    entities:
      - name: patient
        type: primary
        expr: gender || '_' || age
    
    dimensions:
      - name: gender
        type: categorical
        expr: gender
      - name: age
        type: categorical
        expr: age
      - name: record_date
        type: time
        expr: record_date::timestamp
        type_params:
          time_granularity: day
    
    measures:
      - name: patient_count
        agg: count
        expr: 1
        description: "Count of patients"
        agg_time_dimension: record_date
      
      - name: female_count
        agg: sum
        expr: case when gender = 'Female' then 1 else 0 end
        description: "Count of female patients"
        agg_time_dimension: record_date
      
      - name: male_count
        agg: sum
        expr: case when gender = 'Male' then 1 else 0 end
        description: "Count of male patients"
        agg_time_dimension: record_date

metrics:
  - name: total_patients
    label: "Total Patients"
    type: simple
    type_params:
      measure: patient_count
    
  - name: female_patient_count
    label: "Female Patient Count"
    type: simple
    type_params:
      measure: female_count
      
  - name: male_patient_count
    label: "Male Patient Count"
    type: simple
    type_params:
      measure: male_count